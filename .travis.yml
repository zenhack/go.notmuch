language: go
go:
  - 1.7
  - 1.11
  - tip
env:
  - notmuch_branch=release
  - notmuch_branch=master
matrix:
  allow_failures:
    - go: tip
    - env: notmuch_branch=master
before_install:
  - uname -a
  - cat /etc/lsb-release
  - go get -u golang.org/x/tools/cmd/cover
  - sudo apt-get update -qq
  - sudo apt-get install dtach libxapian-dev libgmime-3.0-dev libtalloc-dev python-sphinx ruby-dev zlib1g-dev

  - git clone --depth=50 https://github.com/notmuch/notmuch.git -b $notmuch_branch
  - pushd notmuch
  - ./configure --prefix=/usr
  - sudo make install
  - popd
  - sudo rm -rf notmuch
# In addition to running the test suite, we should also make sure the example
# builds.
script: make ci
